---
title: "Analysis of the citizen initiatives and civic crowdfunding survey for BrusselsTogether" 
subtitle: "R code for reproducible research"
author: "Paramio J., Piette C., Heremans S., Comté F., Mercier A."
date: '`r format(Sys.time(), "%d %B, %Y")`'
output:
  html_document:
    code_folding: hide
    fig_height: 5
    theme: flatly
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: true
      smooth_scroll: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message = FALSE, warning = FALSE, echo = FALSE, out.width = "40%"}
# All defaults
library(knitr)
include_graphics("inputs/SolvayBS_logo.gif")
```

# Summary 

This document provides the R code used to analyze survey data in the context of a the market research done by students at ULB/Sovay Brussels School on citizen initiatives and, in particular, civic crowdfunding. This research originated from a need by BrusselsTogether to better understand the factors driving the success of their own civic crowdfunding platform.

The present document provides all of the code written in R in order for anyone to be able to check and reproduce the findings resulting from the online survey launched in April 2018 by the students.

The input files as well as the code can be retrieved on our [Github page](https://github.com/antoinemercier82/BrusselsTogether-Mkg-Analytics-Solvay-BS-2018).

# Data Preprocessing

### Preparation

```{r loading_packages, message = FALSE, warning = FALSE}
library(readr)
library(lubridate)
library(stringr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(hrbrthemes)
library(knitr)
library(kableExtra)
library(lavaan)
library(likert)
library(reshape2)
library(RColorBrewer)
library(ggthemes)
library(tibble)
library(broom)
library(rebus)
```

### Import

There are only two input files (`Citizen initiative.csv` and  `header_lookup.txt`) which can be retrieved from the Github page mentionned above.

```{r message = FALSE, warning = FALSE}
survey_df <- read_csv("inputs/Citizen initiative.csv")
header_lookup <- read_delim("inputs/header_lookup.txt", delim = ";")
# names(survey_df) <- header_lookup$df_header
```


### Preprocessing

The preprocessing code is available below, although in order to improve the clarity of this document, **it is better to hide this code** (click on the `Hide` button on the right).

```{r message = FALSE, warning = FALSE}
# Dates preprocessing
survey_df$date <- str_replace(string = survey_df$date,
                              pattern = "M GMT.*$",
                              replacement = "M")

survey_df$date <- str_replace_all(string = survey_df$date,
                                  pattern = "/",
                                  replacement = "-")

survey_df$date <- ymd_hms(survey_df$date)

survey_df <- survey_df %>% 
                filter(date > "2018-04-27 20:00:00")

# Language preprocessing
lut_lang <- c("English" = "English",
              "Nederlands" = "Dutch",
              "Français" = "French")

survey_df$lang <- lut_lang[survey_df$lang]

# Grouping preprocessing
lut_group_eng <- c("Citizen with no active implication in a local citizen's initiative, social project or social organization." = "Citizen_not_active",
                   "Active member of a local citizen's initiative, social project or social organization." = "Active_member",
                   "Citizen with casual volonteering for a local citizen's initiative, social project or social organization." = "Citizen_casual_vol")

lut_group_nl <- c("Een burger die geen deel uitmaakt van een lokaal burgerinitiatief, een sociaal project of een sociale organisatie." = "Citizen_not_active",
                  "Een burger die occasioneel bijdraagt als vrijliger van een lokaal burgerinitiatief, een sociaal project of een sociale organisatie." = "Citizen_casual_vol",
                  "Een actief lid van een lokaal burgerinitiatief, van een sociaal project of een sociale organisatie." = "Active_member")

lut_group_fr <- c("Citoyen.ne sans appartenance à une initiative citoyenne locale, un projet social ou une organisation sociale." = "Citizen_not_active",
                  "Citoyen.ne contribuant de manière occasionnelle en tant que volontaire à une initiative citoyenne locale, un projet social ou une organisation sociale." = "Citizen_casual_vol",
                  "Membre actif d'une initiative citoyenne locale, d'un projet social ou d'une organisation sociale." = "Active_member")


survey_df$grouping_eng <- lut_group_eng[survey_df$grouping_eng]
survey_df$grouping_nl <- lut_group_nl[survey_df$grouping_nl]
survey_df$grouping_fr <- lut_group_fr[survey_df$grouping_fr]

# Entrepreuneurs interest preprocessing
lut_e_int_eng <- c("I am not interested in joining a civic crowdfunding platform." = "Not_interested",
                   "I could be interested to join a civic crowdfunding platform." = "Could_be_interested",
                   "I am ready to join a civic crowdfunding platform." = "Is_ready")

survey_df$e_interest_nl <- str_replace(survey_df$e_interest_nl,
                                       pattern = "een " %R% ANY_CHAR %R% "civic crowdfunding" %R% ANY_CHAR %R% " platform",
                                       replacement = "een civic crowdfunding platform")

lut_e_int_nl <- c("Ik ben niet geinteresseerd bij het toetreden van een civic crowdfunding platform." = "Not_interested",
                  "Ik zou geinteresseerd kunnen zijn in het toetreden van een civic crowdfunding platform." = "Could_be_interested",
                  "Ik wil deel uitmaken van een civic crowdfunding platform." = "Is_ready")

lut_e_int_fr <- c("Je ne suis pas intéressé.e par l'adhésion à une plateforme de crowdfunding citoyen." = "Not_interested",
                  "Je pourrais être intéressé.e par l'adhésion à une plateforme de crowdfunding citoyen." = "Could_be_interested",
                  "Je suis prêt.e à rejoindre une plateforme de crowdfunding citoyen." = "Is_ready")

survey_df$e_interest_eng <- lut_e_int_eng[survey_df$e_interest_eng]
survey_df$e_interest_nl <- lut_e_int_nl[survey_df$e_interest_nl]
survey_df$e_interest_fr <- lut_e_int_fr[survey_df$e_interest_fr]

# Likert scale questions preprocessing
lut_likert_nl <- c("Helemaal niet akkoord" = "Strongly disagree",
                   "Niet akkoord" = "Disagree",
                   "Geen mening" = "Neither agree nor disagree",
                   "Akkoord" = "Agree",
                   "Helemaal akkoord" = "Strongly agree",
                   "Helemaal niet akkoord" = "Strongly disagree",
                   "niet akkoord" = "Disagree",
                   "geen mening" = "Neither agree nor disagree",
                   "akkoord" = "Agree",
                   "helemaal akkoord" = "Strongly agree")

lut_likert_fr <- c("Pas du tout d'accord" = "Strongly disagree",
                   "Pas d'accord" = "Disagree",
                   "Sans opinion" = "Neither agree nor disagree",
                   "D'accord" = "Agree",
                   "Tout à fait d'accord" = "Strongly agree")

survey_df[] <- lapply(colnames(survey_df),
                      function(x) {
                        y <- survey_df[[x]]
                        if (str_detect(x, pattern = "^._.[0-9]_nl$")) {
                          y <- lut_likert_nl[y]
                          }
                        return(y)
                        })

survey_df[] <- lapply(colnames(survey_df),
                      function(x) {
                        y <- survey_df[[x]]
                        if (str_detect(x, pattern = "^._.[0-9]_fr$")) {
                          y <- lut_likert_fr[y]
                        }
                        return(y)
                      })

# Citizen interest preprocessing
lut_c_int_eng <- c("I am not interested in citizen's initiatives." = "Not_interested",
                   "I could be interested to fund a citizen's initiative." = "Could_be_interested_Fund",
                   "I could be interested to volunteer for a citizen's initiative." = "Could_be_interested_Vol",
                   "I am ready to fund a citizen's initiative." = "Is_ready_Fund",
                   "I am ready to volunteer for a citizen's initiative." = "Is_ready_Vol")

lut_c_int_nl <- c("Ik ben niet geinteresseerd door burgerinitiatieven" = "Not_interested",
                  "Ik zou eventueel geinteresseerd kunnen zijn door het financieren van burgerinitiatieven" = "Could_be_interested_Fund",
                  "Ik zou eventueel geinteresseerd kunnen zijn door het financieel te ondersteunen van burgerinitiatieven" = "Could_be_interested_Fund",
                  "Ik zou eventueel geinteresseerd zijn om een vrijwillige bijdrage te leveren aan een burgerinitiatief" = "Could_be_interested_Vol",
                  "Ik ben klaar om burgerinitiatieven te financieren" = "Is_ready_Fund",
                  "Ik ben klaar om vrijwilig mee te draaien in een burgerinitiatief" = "Is_ready_Vol")

lut_c_int_fr <- c("Je ne suis pas intéressé.e par les initiatives citoyennes" = "Not_interested",
                  "Je pourrais être éventuellement intéressé.e par le financement d'une initiative citoyenne" = "Could_be_interested_Fund",
                  "Je pourrais être éventuellement intéressé.e par une contribution en tant que volontaire dans une initiative citoyenne" = "Could_be_interested_Vol",
                  "Je suis prêt.e à financer une initiative citoyenne" = "Is_ready_Fund",
                  "Je suis prêt.e à contribuer en tant que volontaire dans une initiative citoyenne" = "Is_ready_Vol")

survey_df$c_interest_eng <- lut_c_int_eng[survey_df$c_interest_eng]
survey_df$c_interest_nl <- lut_c_int_nl[survey_df$c_interest_nl]
survey_df$c_interest_fr <- lut_c_int_fr[survey_df$c_interest_fr]

# Citizen already investing question preprocessing
lut_c_invest_eng <- c("0\u20AC" = "0",
                      "1 - 99\u20AC /year" = "1_99",
                      "100 - 199\u20AC /year" = "100_199",
                      "200 - 499\u20AC /year" = "200_499",
                      "500\u20AC + /year" = "500_plus")

lut_c_invest_nl <- c("0€" = "0",
                     "1 - 99€ /jaar" = "1_99",
                     "100 - 199€ /jaar" = "100_199",
                     "200 - 499€ /jaar" = "200_499",
                     "500€ + /jaar" = "500_plus")

lut_c_invest_fr <- c("0€" = "0",
                     "1 - 99€ /an" = "1_99",
                     "100 - 199€ /an" = "100_199",
                     "200 - 499€ /an" = "200_499",
                     "500€ + /an" = "500_plus")

# survey_df$c_invest_eng <- lut_c_invest_eng[survey_df$c_invest_eng]
# survey_df$c_invest_nl <- lut_c_invest_nl[survey_df$c_invest_nl]
# survey_df$c_invest_fr <- lut_c_invest_fr[survey_df$c_invest_fr]

replace_amount <- function(x, a, b) {
  mask <- str_detect(x, pattern = paste0("^", a))
  x[which(mask)] <- b
  return(x)
}

survey_df$c_invest_eng <- replace_amount(survey_df$c_invest_eng,
                                         a = "0",
                                         b = "0")
survey_df$c_invest_eng <- replace_amount(survey_df$c_invest_eng,
                                         a = "1 ",
                                         b = "1_99")
survey_df$c_invest_eng <- replace_amount(survey_df$c_invest_eng,
                                         a = "10",
                                         b = "100_199")
survey_df$c_invest_eng <- replace_amount(survey_df$c_invest_eng,
                                         a = "2",
                                         b = "200_499")
survey_df$c_invest_eng <- replace_amount(survey_df$c_invest_eng,
                                         a = "5",
                                         b = "500_plus")


survey_df$c_invest_nl <- replace_amount(survey_df$c_invest_nl,
                                         a = "0",
                                         b = "0")
survey_df$c_invest_nl <- replace_amount(survey_df$c_invest_nl,
                                         a = "1 ",
                                         b = "1_99")
survey_df$c_invest_nl <- replace_amount(survey_df$c_invest_nl,
                                         a = "10",
                                         b = "100_199")
survey_df$c_invest_nl <- replace_amount(survey_df$c_invest_nl,
                                         a = "2",
                                         b = "200_499")
survey_df$c_invest_nl <- replace_amount(survey_df$c_invest_nl,
                                         a = "5",
                                         b = "500_plus")


survey_df$c_invest_fr <- replace_amount(survey_df$c_invest_fr,
                                         a = "0",
                                         b = "0")
survey_df$c_invest_fr <- replace_amount(survey_df$c_invest_fr,
                                         a = "1 ",
                                         b = "1_99")
survey_df$c_invest_fr <- replace_amount(survey_df$c_invest_fr,
                                         a = "10",
                                         b = "100_199")
survey_df$c_invest_fr <- replace_amount(survey_df$c_invest_fr,
                                         a = "2",
                                         b = "200_499")
survey_df$c_invest_fr <- replace_amount(survey_df$c_invest_fr,
                                         a = "5",
                                         b = "500_plus")



# Contrib neighb question preprocessing
survey_df$ec_neighb_nl <- lut_likert_nl[survey_df$ec_neighb_nl]
survey_df$ec_neighb_fr <- lut_likert_fr[survey_df$ec_neighb_fr]

# Location question preprocessing
lut_loc_eng <- c("Brussels" = "Brussels",
                 "Outside Belgium" = "Brussels",
                 "Flanders" = "Flanders",
                 "Wallonia" = "Wallonia")


lut_loc_nl <- c("Brussel" = "Brussels",
                "Brussels" = "Brussels",
                "Vlanderen" = "Flanders",
                "Vlaanderen" = "Flanders",
                "Wallonië" = "Wallonia")

lut_loc_fr <- c("Bruxelles-Capitale" = "Brussels",
                "Flandre" = "Flanders",
                "Wallonie" = "Wallonia")

survey_df$ec_loc_eng <- lut_loc_eng[survey_df$ec_loc_eng]
survey_df$ec_loc_nl <- lut_loc_nl[survey_df$ec_loc_nl]
survey_df$ec_loc_fr <- lut_loc_fr[survey_df$ec_loc_fr]

# Gender question preprocessing
lut_gen_eng <- c("Female" = "Female",
                 "Male" = "Male",
                 "Other/I prefer keep it for myself" = "Other")

lut_gen_nl <- c("een vrow" = "Female",
                "een man" = "Male",
                "anders/Ik hou het liever voor mezelf." = "Other")

lut_gen_fr <- c("Une femme" = "Female",
                "Un homme" = "Male",
                "Autre/Je préfère le garder pour moi" = "Other")

survey_df$ec_gender_eng <- lut_gen_eng[survey_df$ec_gender_eng]
survey_df$ec_gender_nl <- lut_gen_nl[survey_df$ec_gender_nl]
survey_df$ec_gender_fr <- lut_gen_fr[survey_df$ec_gender_fr]

# Age question preprocessing
lut_age_eng <- c("Under 14 years old." = "14_and_below",
                 "14-17 years old." = "14_17",
                 "18-24 years old." = "18_24",
                 "25-34 years old." = "25_34",
                 "35-44 years old." = "35_44",
                 "45-54 years old." = "45_54",
                 "55-64 years old." = "55_64",
                 "65-74 years old." = "65_74",
                 "75 years or older." = "75_plus")

lut_age_nl <- c("onder 14 jaar" = "14_and_below",
                "14-17 jaar" = "14_17",
                "18-24jaar" = "18_24",
                "25-34jaar" = "25_34",
                "35-44jaar" = "35_44",
                "45-54jaar" = "45_54",
                "55-64jaar" = "55_64",
                "65-74jaar" = "65_74",
                "75 jaar of ouder" = "75_plus")

lut_age_fr <- c("En dessous de 14 ans." = "14_and_below",
                "14-17 ans." = "14_17",
                "18-24 ans." = "18_24",
                "25-34 ans." = "25_34",
                "35-44 ans." = "35_44",
                "45-54 ans." = "45_54",
                "55-64 ans." = "55_64",
                "65-74 ans." = "65_74",
                "75 ans ou plus." = "75_plus")

survey_df$ec_age_eng <- lut_age_eng[survey_df$ec_age_eng]
survey_df$ec_age_nl <- lut_age_nl[survey_df$ec_age_nl]
survey_df$ec_age_fr <- lut_age_fr[survey_df$ec_age_fr]

# Education question preprocessing
survey_df$ec_edu_eng <- str_replace(survey_df$ec_edu_eng,
                                    pattern = "Bachelor" %R% ANY_CHAR %R% "s",
                                    replacement = "Bachelor")

survey_df$ec_edu_eng <- str_replace(survey_df$ec_edu_eng,
                                    pattern = "Master" %R% ANY_CHAR %R% "s",
                                    replacement = "Masters")

lut_edu_eng <- c("Primary school or no schooling completed" = "Primary_or_None",
                 "High-School" = "High_school",
                 "Trade/technical/vocational training." = "Technical",
                 "Bachelor degree." = "Bachelor",
                 "Masters degree." = "Master",
                 "Doctorate degree." = "PhD")

lut_edu_nl <- c("Lagere school of zonder diploma" = "Primary_or_None",
                "Humaniora" = "High_school",
                "Technische Humaniora" = "Technical",
                "Bachelor" = "Bachelor",
                "Master" = "Master",
                "Doctoraat" = "PhD")

lut_edu_fr <- c("Primaire ou sans diplôme" = "Primary_or_None",
                "Diplôme secondaire" = "High_school",
                "Diplôme secondaire + des formations qualifiantes" = "High_school",
                "Diplôme secondaire technique" = "Technical",
                "Bachelier" = "Bachelor",
                "Master" = "Master",
                "Double master même ;-)" = "Master",
                "Doctorat" = "PhD",
                "Post universirtaire" = "PhD")

survey_df$ec_edu_eng <- lut_edu_eng[survey_df$ec_edu_eng]
survey_df$ec_edu_nl <- lut_edu_nl[survey_df$ec_edu_nl]
survey_df$ec_edu_fr <- lut_edu_fr[survey_df$ec_edu_fr]



# Merging columns from the different languages
all_cols <- names(survey_df)
eng_cols <- all_cols[str_detect(all_cols, pattern = "eng$")]
nl_cols <- all_cols[str_detect(all_cols, pattern = "nl$")]
fr_cols <- all_cols[str_detect(all_cols, pattern = "fr$")]

merged_cols <- str_replace(eng_cols,
                           pattern = "_eng$",
                           replacement = "")

temp_df <- tbl_df(data.frame(matrix(nrow = nrow(survey_df),
                             ncol = length(merged_cols))))
colnames(temp_df) <- merged_cols

survey_df <- tbl_df(cbind(survey_df, temp_df))

survey_df[is.na(survey_df)] <- ""

for (i in 1:length(merged_cols)) {
  m <- merged_cols[i]
  e <- eng_cols[i]
  n <- nl_cols[i]
  f <- fr_cols[i]
  survey_df[[m]] <- paste0(survey_df[[e]], survey_df[[n]], survey_df[[f]])
}

survey_df$lang <- factor(survey_df$lang,
                         levels = c("English", "Dutch", "French"))
survey_df$ec_gender <- factor(survey_df$ec_gender,
                              levels = c("Female", "Male", "Other"))

# Split survey_df_e/survey_df_c

survey_df_e <- survey_df %>%
  filter(grouping == "Active_member") %>% 
  select(date, lang, grouping:e_g6, ec_neighb:ec_edu)

temp_coln <- str_replace(names(survey_df_e), "^e_", "")
temp_coln <- str_replace(temp_coln, "^ec_", "")
temp_coln <- str_replace(temp_coln, "lang", "language")
names(survey_df_e) <- temp_coln

survey_df_e$age <- factor(survey_df_e$age, ordered = TRUE,
                              levels = c("14_and_below",
                                         "14_17",
                                         "18_24",
                                         "25_34",
                                         "35_44",
                                         "45_54",
                                         "55_64",
                                         "65_74",
                                         "75_plus"))

survey_df_e$loc <- factor(survey_df_e$loc, ordered = TRUE,
                          levels = c("Brussels",
                                     "Flanders",
                                     "Wallonia"))

survey_df_e$edu <- factor(survey_df_e$edu, ordered = TRUE,
                          levels = c("Primary_or_None",
                                     "High_school",
                                     "Technical",
                                     "Bachelor",
                                     "Master",
                                     "PhD"))

survey_df_e$interest <- factor(survey_df_e$interest, ordered = TRUE,
                               levels = c("Not_interested",
                                          "Could_be_interested",
                                          "Is_ready"))

survey_df_c <- survey_df %>%
  filter(grouping != "Active_member") %>% 
  select(date, lang, grouping, c_interest:ec_edu)

temp_coln <- str_replace(names(survey_df_c), "^c_", "")
temp_coln <- str_replace(temp_coln, "^ec_", "")
temp_coln <- str_replace(temp_coln, "lang", "language")
names(survey_df_c) <- temp_coln

survey_df_c$age <- factor(survey_df_c$age, ordered = TRUE,
                          levels = c("14_and_below",
                                     "14_17",
                                     "18_24",
                                     "25_34",
                                     "35_44",
                                     "45_54",
                                     "55_64",
                                     "65_74",
                                     "75_plus"))

survey_df_c$loc <- factor(survey_df_c$loc, ordered = TRUE,
                          levels = c("Brussels",
                                     "Flanders",
                                     "Wallonia"))

survey_df_c$edu <- factor(survey_df_c$edu, ordered = TRUE,
                          levels = c("Primary_or_None",
                                     "High_school",
                                     "Technical",
                                     "Bachelor",
                                     "Master",
                                     "PhD"))

survey_df_c$interest <- factor(survey_df_c$interest, ordered = TRUE,
                                  levels = c("Not_interested",
                                             "Could_be_interested_Vol",
                                             "Could_be_interested_Fund",
                                             "Is_ready_Vol",
                                             "Is_ready_Fund"))


survey_df_c$grouping <- factor(survey_df_c$grouping, ordered = TRUE,
                               levels = c("Citizen_not_active",
                                          "Citizen_casual_vol"))

convert_to_fact_lik <- function(df, columns) {
  for (column in columns) {
    df[[column]] <- factor(df[[column]],
                           levels = c("Strongly disagree",
                                      "Disagree",
                                      "Neither agree nor disagree",
                                      "Agree",
                                      "Strongly agree"))
  }
  return(df)
}

e_likert_cols <- names(survey_df_e)[5:(length(survey_df_e) - 5)]
c_likert_cols <- names(survey_df_c)[5:(length(survey_df_c) - 6)]

survey_df_e <- convert_to_fact_lik(survey_df_e, e_likert_cols)
survey_df_c <- convert_to_fact_lik(survey_df_c, c_likert_cols)

survey_df_e <- convert_to_fact_lik(survey_df_e, "neighb")
survey_df_c <- convert_to_fact_lik(survey_df_c, "neighb")

survey_df_c$invest <- factor(survey_df_c$invest, ordered = TRUE,
                             levels = c("", "0", "1_99", "100_199",
                                        "200_499", "500_plus"))

survey_df_e_j <- survey_df_e %>% select(date,
                                        language,
                                        grouping,
                                        loc,
                                        gender,
                                        age,
                                        edu) %>% mutate(resp_type = "Entrepreneur")

survey_df_c_j <- survey_df_c %>% select(date,
                                        language,
                                        grouping,
                                        loc,
                                        gender,
                                        age,
                                        edu) %>% mutate(resp_type = "Citizen")

survey_df_j <- survey_df_e_j %>% bind_rows(survey_df_c_j)

survey_df_j$resp_type <- factor(survey_df_j$resp_type,
                                levels = c("Entrepreneur", "Citizen"))


```

# Part II - Entrepreneurs

# Exploratory Data Analysis

### Control variables

The EDA of the control variables for the entrepreneurs was actually shared with the EDA of the control variables for the citizens. Please refer back to that section if needed.

### Dependent and independent variables

Concerning the entrepeneurs (active members of a local citizens initiative, social project or social organization), the objective of this survey is to test two hypotheses that were derived from our qualitative research:

1. H1: A more participative platform is positively correlated with the interest to join a civic crowdfunding platform.
2. H2: A positive opinion on projects that are co-created by social entrepreneurs and the local government is positively correlated with the interest to join a civic crowdfunding platform.

The interest to join a civic crowdfunding platform is thus our dependent variable (this is the outcome that BrusselsTogether would like to improve) and is measured by the question shown in the table below. Also shown in this table is the related variable name in the R code.

```{r}
x <- list(q = names(lut_e_int_eng), v = levels(survey_df_e$interest)) %>% as_data_frame()
colnames(x) <- c(header_lookup$google_f_header[4], "variable_name")
x %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

The answers are distributed as shown in the figure below:

```{r fig.height = 2.9, fig.width = 10, fig.align = "center"}
survey_df_e %>%
  count(interest) %>%
  rename(interest_count = n) %>%
  mutate(interest = reorder(interest, interest_count)) %>%
  ggplot(aes(x = interest, y = interest_count)) +
  geom_col(fill = "#2C7FB8", alpha = 0.8) +
  theme_ipsum_rc(grid = "X") +
  scale_fill_ipsum() +
  coord_flip() +
  labs(title = "Distribution of responses to interest question", x = "") +
  theme(plot.title = element_text(size = 14, hjust = 0.5)) +
  theme(axis.text.y = element_text(hjust = 0)) +
  theme(plot.margin = unit(c(1,1,1,0), "cm"))

```

```{r}
options(scipen = 999, digits = 2)

survey_df_e %>% 
  count(interest) %>% 
  mutate(total = sum(n),
         percent = n / total) %>% 
  select(interest, n, percent) %>% 
  arrange(desc(n)) %>% 
  kable() %>%
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

The independent variables (the appeal of a more participative platform for H1 and the opinion on projects that are co-created by social entrepreneurs and the local government through civic crowdfunding platforms for H2) are what we think could be drivers for the dependent variable (although we could not make causal inference from an observational study like this one). If the correlations are verified, then we could provide BrusselsTogether with actionnable recommendations, such as making the platform more participative or playing a role of intermediary between citizens initiatives and the local authorities.

For each of the two independent variables, we asked a set of questions which, in our opinion, should reflect their corresponding independent variable. In this case, we could say that the independent variables are latent variables that are each measured by a set of several items.

The table below displays the items and their related variable name in the R code. The items related to the appeal of a more participative platform are `p1` to `p5` and the items related to opinion on projects that are co-created by social entrepreneurs and the local government through civic crowdfunding platforms are `g1` to `g6`.

Additionnaly, we asked the respondants whether their interest in contributing to the future of their neighborhood had increased in the past several years (variable name `neighb`).

All of those items were measured on a 5-points Likert scale, from "strongly disagree" to "strongly agree".

```{r}
meta <- data_frame(question = header_lookup$google_f_header[c(5:15, 29)],
                   variable_name = names(survey_df_e)[c(5:16)])

meta %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = T, font_size = 14)
```

The answers are distributed as shown in the three plots below:

```{r}
lik_plot <- function(t, my_df_names, mylevels, factor_levels, p_title) {
  tab <- rownames_to_column(data.frame(unclass(t)), "rownames_col")
  names(tab) <- my_df_names
  tab$interest <- factor(tab$interest, ordered = T, levels = factor_levels)
  
  numlevels <- length(tab[1,]) - 1
  numcenter <- ceiling(numlevels / 2) + 1
  tab$midvalues <- tab[,numcenter] / 2
  tab2 <- cbind(tab[,1],
                tab[,2:ceiling(numlevels / 2)],
                tab$midvalues,
                tab$midvalues,
                tab[,numcenter:numlevels + 1])
  
  colnames(tab2) <- c("outcome",
                      mylevels[1:floor(numlevels / 2)],
                      "midlow",
                      "midhigh",
                      mylevels[numcenter:numlevels])
  
  numlevels <- length(mylevels) + 1
  point1 <- 2
  point2 <- ((numlevels) / 2) + 1
  point3 <- point2 + 1
  point4 <- numlevels + 1
  mymin <- (ceiling(max(rowSums(tab2[,point1:point2])) * 4) / 4) * -100
  mymax <- (ceiling(max(rowSums(tab2[,point3:point4])) * 4) / 4) * 100
  
  numlevels <- length(tab[1,]) - 1
  temp.rows <- length(tab2[,1])
  pal <- brewer.pal((numlevels - 1),"BrBG")
  pal[ceiling(numlevels / 2)] <- "#DFDFDF"
  legend.pal <- pal
  pal <- c(pal[1:(ceiling(numlevels / 2) - 1)],
           pal[ceiling(numlevels / 2)],
           pal[ceiling(numlevels / 2)],
           pal[(ceiling(numlevels / 2) + 1):(numlevels - 1)])
  
  tab3 <- melt(tab2, id = "outcome")
  tab3$col <- rep(pal, each = temp.rows)
  tab3$value <- tab3$value * 100
  tab3$outcome <- str_wrap(tab3$outcome, width = 70)
  tab3$outcome <- factor(tab3$outcome, ordered = T,
                         levels = str_wrap(factor_levels, width = 70))
  highs <- na.omit(tab3[(length(tab3[,1]) / 2) + 1:length(tab3[,1]),])
  lows <- na.omit(tab3[1:(length(tab3[,1]) / 2),])
  lows <- lows[rev(rownames(lows)),]
  
  highs$col <- factor(highs$col, ordered = T, levels = c("#018571",
                                                         "#80CDC1",
                                                         "#DFDFDF"))
  lows$col <- factor(lows$col, ordered = T, levels = c("#A6611A",
                                                       "#DFC27D",
                                                       "#DFDFDF"))
  
  highs$outcome <- factor(highs$outcome, ordered = T,
                          levels = rev(levels(highs$outcome)))
  lows$outcome <- factor(lows$outcome, ordered = T,
                         levels = rev(levels(lows$outcome)))
  # lows$outcome
  # highs$outcome <- factor(highs$outcome, ordered = T,
  #                        levels = tab2$outcome[order(-(tab2[,5] + tab2[,6] + tab2[,7]))])
  
  ggplot() +
    geom_bar(data = highs, alpha = 0.8, aes(x = outcome, y = value, fill = col), position = "stack", stat = "identity") +
    geom_bar(data = lows, alpha = 0.8, aes(x = outcome, y = -value, fill = col), position = "stack", stat = "identity") +
    geom_hline(yintercept = 0, color = c("white")) +
    scale_fill_identity("Percent", labels = mylevels, breaks = legend.pal, guide = "legend") + 
    theme_fivethirtyeight() +
    coord_flip() +
    theme_ipsum_rc() +
    labs(title = p_title, y = "",x = "") +
    theme(plot.title = element_text(size = 14, hjust = 0.5)) +
    theme(axis.text.y = element_text(hjust = 0)) +
    theme(legend.position = "bottom") +
    scale_y_continuous(breaks = seq(-100,100,25), limits = c(-100,100), labels = function(x) paste0(x, "%")) +
    theme(plot.margin = unit(c(1,1,1,0), "cm")) +
    theme(
      # panel.grid.major.x = element_blank(),
      # panel.grid.minor.x = element_blank(),
      panel.grid.major.y = element_blank(),
      panel.grid.minor.y = element_blank()
      )
}
```

```{r fig.height = 5.5, fig.width = 10, fig.align = "center"}
questions_e <- header_lookup$google_f_header[5:15]
quest_code_e <- names(survey_df_e)[5:15]
survey_df_e_df <- as.data.frame(survey_df_e)
names(survey_df_e_df)[5:15] <- questions_e



my_df_names_e_p <- c("interest", "Strongly disagree", "Disagree", "Neither agree nor disagree",
                     "Agree", "Strongly agree")
mylevels_e_p <- c("Strongly disagree", "Disagree", "Neither agree nor disagree",
                  "Agree", "Strongly agree")
factor_levels_e_p <- c("Face-to-face interactions are necessary for collective action.",
                       "For most citizens on a civic crowdfunding platform, personnally funding a citizen's initiative is enough to satisfy their desire to engage in this project.",
                       "Citizens would like to participate in debates on local public issues that they care about.",
                       "It is relatively easy for citizens to find places where local public issues are collectively debated.",
                       "I would welcome the possibility for citizens on a crowdfunding platform to express their disagreement about some aspects of the projects they contribute to financially.")

temp_e_p <- survey_df_e_df[,5:9]

temp_e_p_gathered <- temp_e_p %>% 
  gather(key = "question", value = "answer")

temp_e_p_gathered$answer <- factor(temp_e_p_gathered$answer, ordered = T,
                                   levels = mylevels_e_p)

t_e_p <- prop.table(table(temp_e_p_gathered$question,
                          temp_e_p_gathered$answer), 1)
e_p_title <- "\n\nEntrepreneurs - Participative questions\n"

lik_plot(t_e_p, my_df_names_e_p, mylevels_e_p, factor_levels_e_p, e_p_title)
```

```{r fig.height = 5.5, fig.width = 10, fig.align = "center"}
my_df_names_e_g <- c("interest", "Strongly disagree", "Disagree", "Neither agree nor disagree",
                 "Agree", "Strongly agree")
mylevels_e_g <- c("Strongly disagree", "Disagree", "Neither agree nor disagree",
              "Agree", "Strongly agree")
factor_levels_e_g <- c("Civic crowdfunding represents a direct threat to the funding of public goods and services by the local government.",
                       "I regard crowdfunded citizen's initiatives as a sort of_Do-It-Yourself government_.",
                       "The local government is able to identify the projects that are most wanted by citizens.",
                       "Civic crowdfunding platforms could play a role of intermediary between citizen's initiatives and the local government.",
                       "General interest issues are addressed more efficiently by crowdfunded citizen's initiatives than by the local government.",
                       "General interest issues are addressed more efficiently by crowdfunded citizen's initiatives than by non-profit organizations subsidized by the local government.")

temp_e_g <- survey_df_e_df[,10:15]

temp_e_g_gathered <- temp_e_g %>% 
  gather(key = "question", value = "answer")

temp_e_g_gathered$answer <- factor(temp_e_g_gathered$answer, ordered = T,
                                   levels = mylevels_e_g)

t_e_g <- prop.table(table(temp_e_g_gathered$question,
                          temp_e_g_gathered$answer), 1)
e_g_title <- "Entrepreneurs - Government questions\n"

lik_plot(t_e_g, my_df_names_e_g, mylevels_e_g, factor_levels_e_g, e_g_title)
```

```{r fig.height = 2.7, fig.width = 10, fig.align = "center"}
questions_neighb <- header_lookup$google_f_header[29]
quest_code_neighb <- names(survey_df_e)[16]
names(survey_df_e_df)[16] <- questions_neighb

my_df_names_e_neighb <- c("interest", "Strongly disagree", "Disagree", "Neither agree nor disagree",
                          "Agree", "Strongly agree")
mylevels_e_neighb <- c("Strongly disagree", "Disagree", "Neither agree nor disagree",
                       "Agree", "Strongly agree")
factor_levels_e_neighb <- c("My interest in contributing to the future of my neighborhood has increased in the past several years.")

temp_e_neighb <- as.data.frame(survey_df_e_df[,16])
names(temp_e_neighb) <- "My interest in contributing to the future of my neighborhood has increased in the past several years."

temp_e_neighb_gathered <- temp_e_neighb %>% 
  gather(key = "question", value = "answer")

temp_e_neighb_gathered$answer <- factor(temp_e_neighb_gathered$answer,
                                        ordered = T,
                                        levels = mylevels_e_neighb)

t_e_neighb <- prop.table(table(temp_e_neighb_gathered$question,
                          temp_e_neighb_gathered$answer), 1)
e_neighb_title <- "Citizens - Interest in future of neighb. question\n"

lik_plot(t_e_neighb, my_df_names_e_neighb, mylevels_e_neighb, factor_levels_e_neighb, e_neighb_title)
```

###  Distribution of answers for independent variables broken down by interest

We can break down the distribution of answers related to the independent variables by interest in joining a civic crowdfunding platform.

As for the analysis of the citizens responses, we should keep in mind that people "ready to join" and "not interested" represent only a fraction of the sample.

Here below is a series of plots related to the "participative" questions.

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
my_df_names <- c("interest", "Strongly disagree", "Disagree", "Neither agree nor disagree",
                 "Agree", "Strongly agree")
mylevels <- c("Strongly disagree", "Disagree", "Neither agree nor disagree",
              "Agree", "Strongly agree")
factor_levels <- c("Not_interested",
                   "Could_be_interested",
                   "Is_ready")

t_p1 <- prop.table(table(survey_df_e$interest, survey_df_e$p1), 1)
p1_title <- "\n\n\nFace-to-face interactions are necessary for collective action.\n"

lik_plot(t_p1, my_df_names, mylevels, factor_levels, p1_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p2 <- prop.table(table(survey_df_e$interest, survey_df_e$p2), 1)
p2_title <- "For most citizens on a civic crowdfunding platform,\npersonnally funding a citizen's initiative is enough to\nsatisfy their desire to engage in this project.\n"

lik_plot(t_p2, my_df_names, mylevels, factor_levels, p2_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p3 <- prop.table(table(survey_df_e$interest, survey_df_e$p3), 1)
p3_title <- "\nCitizens would like to participate in debates\non local public issues that they care about.\n"

lik_plot(t_p3, my_df_names, mylevels, factor_levels, p3_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p4 <- prop.table(table(survey_df_e$interest, survey_df_e$p4), 1)
p4_title <- "\nIt is relatively easy for citizens to find places where\nlocal public issues are collectively debated.\n"

lik_plot(t_p4, my_df_names, mylevels, factor_levels, p4_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p5 <- prop.table(table(survey_df_e$interest, survey_df_e$p5), 1)
p5_title <- "I would welcome the possibility for citizens on a crowdfunding platform\nto express their disagreement about some aspects\nof the projects they contribute to financially.\n"

lik_plot(t_p5, my_df_names, mylevels, factor_levels, p5_title)
```

Here below is a series of plots related to the "government" questions.

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
my_df_names <- c("interest", "Strongly disagree", "Disagree", "Neither agree nor disagree",
                 "Agree", "Strongly agree")
mylevels <- c("Strongly disagree", "Disagree", "Neither agree nor disagree",
              "Agree", "Strongly agree")
factor_levels <- c("Not_interested",
                   "Could_be_interested",
                   "Is_ready")

t_g1 <- prop.table(table(survey_df_e$interest, survey_df_e$g1), 1)
g1_title <- "\nCivic crowdfunding represents a direct threat to the funding of\npublic goods and services by the local government.\n"

lik_plot(t_g1, my_df_names, mylevels, factor_levels, g1_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g2 <- prop.table(table(survey_df_e$interest, survey_df_e$g2), 1)
g2_title <- "\nI regard crowdfunded citizen's initiatives\nas a sort of_Do-It-Yourself government_.\n"

lik_plot(t_g2, my_df_names, mylevels, factor_levels, g2_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g3 <- prop.table(table(survey_df_e$interest, survey_df_e$g3), 1)
g3_title <- "\nThe local government is able to identify\nthe projects that are most wanted by citizens.\n"

lik_plot(t_g3, my_df_names, mylevels, factor_levels, g3_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g4 <- prop.table(table(survey_df_e$interest, survey_df_e$g4), 1)
g4_title <- "\nCivic crowdfunding platforms could play a role of intermediary\nbetween citizen's initiatives and the local government.\n"

lik_plot(t_g4, my_df_names, mylevels, factor_levels, g4_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g5 <- prop.table(table(survey_df_e$interest, survey_df_e$g5), 1)
g5_title <- "\nGeneral interest issues are addressed more efficiently by\ncrowdfunded citizen's initiatives than by the local government.\n"

lik_plot(t_g5, my_df_names, mylevels, factor_levels, g5_title)
```

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g6 <- prop.table(table(survey_df_e$interest, survey_df_e$g6), 1)
g6_title <- "General interest issues are addressed more efficiently by\ncrowdfunded citizen's initiatives than by\nnon-profit organizations subsidized by the local government.\n"

lik_plot(t_g6, my_df_names, mylevels, factor_levels, g6_title)
```

Here below is the plot related to the "interest in the future of my neighborhood" question.

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_neighb <- prop.table(table(survey_df_e$interest, survey_df_e$neighb), 1)
neighb_title <- "\nMy interest in contributing to the future of my neighborhood\nhas increased in the past several years.\n"

lik_plot(t_neighb, my_df_names, mylevels, factor_levels, neighb_title)
```

###  Distribution of answers for independent variables broken down by education

Here below is a plot showing the education vs answers to independent variables questions, broken down by independent variables questions.

```{r fig.height = 7, fig.width = 10, fig.align = "center"}
survey_df_e <- survey_df_e %>% 
  mutate(edu_num = unclass(survey_df_e$edu))

tidy_survey_df_e <- survey_df_e %>% 
  select(edu_num, p1:g6, neighb) %>% 
  data.matrix() %>% 
  as_data_frame() %>% 
  gather(key, value, -edu_num)

tidy_survey_df_e %>%
  group_by(key, value) %>%
  summarize(edu_num = mean(edu_num, na.rm = TRUE)) %>%
  ggplot(aes(value, edu_num, color = key)) +
  geom_line(size = 1.2, show.legend = FALSE, alpha = 0.5) +
  geom_point() +
  labs(title = "Relationship btw education and answers to likert scale questions",
       x = "Answer to likert scale question", y = "Mean education") +
  facet_wrap(~factor(key, ordered = T,
                     levels = c("p1", "p2", "p3", "p4", "p5", "g1", "g2",
                                "g3", "g4", "g5", "g6", "neighb")), nrow = 3) +
  theme_ipsum_rc() +
  theme(plot.title = element_text(size = 14, hjust = 0.5)) +
  theme(axis.text.y = element_text(hjust = 0)) +
  theme(legend.position = "none") +
  theme(plot.margin = unit(c(1,1,1,0), "cm")) +
  theme(
    panel.grid.minor.y = element_blank()
  )
```

For this plot, the education is coded as an integer value as shown in the following table (see the column "edu_num"). This table also shows the count for each level (under the column "n").

```{r}
options(scipen = 999, digits = 3)

survey_df_e %>% 
  count(edu, edu_num) %>%
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

Here below is a reminder of the questions and their variable names.

```{r}
meta <- data_frame(question = header_lookup$google_f_header[c(5:15, 29)],
                   variable_name = names(survey_df_e)[c(5:16)])

meta %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = T, font_size = 14)
```

###  Distribution of answers for independent variables broken down by age

Here below is a plot showing the mean age vs answers to independent variables questions, broken down by independent variables questions.

```{r fig.height = 7, fig.width = 10, fig.align = "center"}
survey_df_e <- survey_df_e %>% 
  mutate(age_num = ifelse(age == "14_and_below", 12,
                          ifelse(age == "14_17", 16,
                                 ifelse(age == "18_24", 20,
                                        ifelse(age == "25_34", 30,
                                               ifelse(age == "35_44", 40,
                                                      ifelse(age == "45_54", 50,
                                                             ifelse(age == "55_64", 60,
                                                                    ifelse(age == "65_74", 70, 80)))))))))

tidy_survey_df_e <- survey_df_e %>% 
  select(age_num, p1:g6, neighb) %>% 
  data.matrix() %>% 
  as_data_frame() %>% 
  gather(key, value, -age_num)

tidy_survey_df_e %>%
  group_by(key, value) %>%
  summarize(age_num = mean(age_num, na.rm = TRUE)) %>%
  ggplot(aes(value, age_num, color = key)) +
  geom_line(size = 1.2, show.legend = FALSE, alpha = 0.5) +
  geom_point() +
  labs(title = "Relationship btw age and answers to likert scale questions",
       x = "Answer to likert scale question", y = "Mean age") +
  facet_wrap(~factor(key, ordered = T,
                     levels = c("p1", "p2", "p3", "p4", "p5", "g1", "g2",
                                "g3", "g4", "g5", "g6", "neighb")), nrow = 3) +
  theme_ipsum_rc() +
  theme(plot.title = element_text(size = 14, hjust = 0.5)) +
  theme(axis.text.y = element_text(hjust = 0)) +
  theme(legend.position = "none") +
  theme(plot.margin = unit(c(1,1,1,0), "cm"))
```

For this plot, the age is coded as an integer value as shown in the following table (see the column "age_num"). This table also shows the count for each level (under the column "n").

```{r}
options(scipen = 999, digits = 3)

survey_df_e %>% 
  count(age, age_num) %>%
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

# Logistic Regression modeling

### Introduction

Similar to what we did in Part I for the citizens, we are going to fit a series of multiple binary logistic regression model in order to see which predictors (in our case the independent variable questions) are associated with the likelihood of entrepreneurs to be interested in joining a civic crowdfunding platforms.

Here again, our dependent variable has more than two classes ("Not interested", "Could be interested" and "Ready to fund"). Therefore, we will fit several models after having split our dependent variable classes into two groups, in several ways.

### Logistic regression with Interest as the target variable

#### Model 1

In this section, we will fit models with Interest (in joining a civic crowdfunding platform) as the target variable and all of the dependent variables, as well as the control variables, as the explanatory variables.

In the first model, we will split the Interest variable into the two following groups:

* Class 0: "Not_interested";
* Class 1: The rest of the possible classes ("Could_be_interested_Vol", "Could_be_interested_Fund", "Is_ready_Vol", "Is_ready_Fund") combined.

Also, we filter out observations with gender other than Female and Male. Females are then represented by the integer value 1 and Male are represented by the integer value 2.

Answers to Likert scale questions range from 1 ("Strongly disagree") to 5 ("Strongly agree").

Answers to the question about the age of the respondant range from 1 ("Under 14 years old") to 9 ("75 years old and plus").

Answers to the education question range from 1 ("Primary_or_None") to 6 ("PhD").

Finally, answers to the location and language questions have three levels:

* "Brussels" = 1, "Flanders" = 2, "Wallonia" = 3;
* "English" = 1, "Dutch" = 2, "French" = 3.

The first few rows of the input to the model look like this:

```{r message = FALSE, warning = FALSE}
survey_df_c_mat <- survey_df_c %>% 
  filter(gender %in% c("Female", "Male")) %>% 
  mutate(interest_binary = ifelse(interest == "Not_interested",
                                  0,
                                  1)) %>% 
  select(interest_binary, language, p1:edu, -invest) %>% 
  data.matrix() %>% 
  as_data_frame()

survey_df_c_mat %>% 
  head() %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = T, font_size = 14)
```

Let us know examine the output of the model:

```{r message = FALSE, warning = FALSE}
glm1 <- glm(interest_binary ~ .,  family = "binomial", 
                  data = survey_df_c_mat)

summary(glm1)
```


This is a lot of output, but we are going to focus on the Coefficients table in the middle.

In order to be able to interpret anything meaningful, we first have to look at the p-values represented in the last column of the Ceofficients table ("Pr(>|z|)"). The p-value is used to test for statistical significance. We won't go into the theory of inference for regression, but simply put, low p-values (below 0.05) generally mean that we can rule out that the effect of the coefficient is due to chance. In other words, we are looking for coefficients for which the p-value is below 0.05.

In the present case, all p-values are about 1, so this model is useless. In fact, the model did not converge. This is probably due to the high imbalance in the response variable. Indeed, as already mentionned, the class "Not_interested" represents only 5% of the sample or 7 out of 150 observations.

Therefore, we cannot infer anything regarding factors that affect the likelihood of people not to be interested in civic crowdfunding platforms as opposed to being somewhat interested ("Could be interested) or definetly interested ("Is ready").

#### Model 2

In this second model, we are filtering out the observations where people are not interested in joining a civic crowdfunding platform, therefore we are now focusing on a subset of the data. Then we split the observations into the two following groups, related to the "interest" variable:

* Class 0: "Could_be_interested_Vol" and "Could_be_interested_Fund";
* Class 1: "Is_ready_Vol" and "Is_ready_Fund".

The rest of the model is similar to the model 1.

```{r message = FALSE, warning = FALSE}
survey_df_c_mat <- survey_df_c %>% 
  filter(gender %in% c("Female", "Male")) %>% 
  filter(interest != "Not_interested") %>% 
  mutate(interest_binary = ifelse(interest %in% c("Is_ready_Vol",
                                                  "Is_ready_Fund"),
                                  1,
                                  0)) %>% 
  select(interest_binary, language, p1:edu, -invest) %>% 
  data.matrix() %>% 
  as_data_frame()

glm2 <- glm(interest_binary ~ .,  family = "binomial", 
                  data = survey_df_c_mat)

summary(glm2)
```

Now we have several variables for which the p-value of the coefficient is less than 0.05. Let's extract them into the following table, which is ordered by "estimate" in descending order:

```{r}
options(scipen = 999, digits = 3)

glm2 %>% 
  tidy() %>%
  filter(p.value < 0.05) %>%
  arrange(desc(estimate)) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

We can interpret this table as follows:

1. Since the effect size (i.e. the estimate of the coefficient) associated with the variable p2 is above zero, then people agreeing with the statement "I would like to participate in debates on local public issues." are more likely to be "ready" to fund or volunteer (they are more likely to have answered "I am ready to..." rather than "I could be interested to..."), after controlling for the other variables in the model.

Let's have a look at a plot similar to what we did in the Exploratory Data Analysis, but without the category "Not interested":

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p2 <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$p2[survey_df_c$interest != "Not_interested"]), 1)
p2_title <- "\n\n\nI would like to participate in debates on local public issues.\n"

lik_plot(t_p2, my_df_names, mylevels, factor_levels, p2_title)
```

This confirms visually the positive relationship identified in point 1.

2. Similarly, since the effect size associated with the variable neighb is positive, then people agreeing with the statement "My interest in contributing to the future of my neighborhood has increased in the past several years." are more likely to be "ready" to fund or volunteer, after controlling for the other variables in the model.

Let's have a look at a plot similar to what we did in the Exploratory Data Analysis, but without the category "Not interested":

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_neighb <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$neighb[survey_df_c$interest != "Not_interested"]), 1)
neighb_title <- "\n\nMy interest in contributing to the future of my neighborhood\nhas increased in the past several years.\n"

lik_plot(t_neighb, my_df_names, mylevels, factor_levels, neighb_title)
```

This confirms visually the positive relationship identified in point 2.

3. Since the effect size associated with the variable age is above zero, then older people are more likely to be "ready" to fund or volunteer, after controlling for the other variables in the model.

Let's have a look at a bar chart representing the proportions of interest conditionned on age group:

```{r fig.height = 6, fig.width = 10, fig.align = "center"}
my_cols <- brewer.pal(9, "YlGnBu")

survey_df_c %>% 
  filter(interest != "Not_interested") %>% 
  ggplot(aes(x = interest, fill = age)) +
  geom_bar(alpha = 0.8, position = "fill") +
  labs(title = "Proportions of interest conditionned on age group", y = "Proportion") +
  theme_ipsum_rc() +
  scale_fill_manual(values = my_cols[3:9]) +
  theme(panel.grid.major.x = element_blank(),
        panel.grid.minor.x = element_blank()) +
  theme(plot.title = element_text(size = 14, hjust = 0.5)) +
  theme(axis.text.y = element_text(hjust = 0)) +
  theme(plot.margin = unit(c(1,1,1,0), "cm"))
```

This plot seems to confirm the positive relationship identified in point 3.

4. Since the effect size associated with the variable g4 is negative, then people agreeing with the statement "Civic crowdfunding platforms could play a role of intermediary between citizen’s initiatives and the local government." are less likely to be "ready" to fund or volunteer (they are more likely to have answered "I could be interested to..."), after controlling for the other variables in the model.

Let's have a look at a plot similar to what we did in the Exploratory Data Analysis, but without the category "Not interested":

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_g4 <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$g4[survey_df_c$interest != "Not_interested"]), 1)
g4_title <- "\n\nCivic crowdfunding platforms could play a role of\nintermediary between citizen's initiatives and the local government.\n"

lik_plot(t_g4, my_df_names, mylevels, factor_levels, g4_title)
```

This confirms visually the negative relationship identified in point 4.

5. Finally, people agreeing with the statement "I would be more inclined to contribute financially to a project on a civic crowdfunding platform if I had the possibility to express my disagreement about some aspects of the project." are less likely to be "ready" to fund or volunteer (they are more likely to have answered "I could be interested to..."), after controlling for the other variables in the model.

Let's try to confirm this visually:

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p4 <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$p4[survey_df_c$interest != "Not_interested"]), 1)
p4_title <- "\nI would be more inclined to contribute financially to\na project on a civic crowdfunding platform if I had the possibility\nto express my disagreement about some aspects of the project.\n"

lik_plot(t_p4, my_df_names, mylevels, factor_levels, p4_title)
```

The negative relationship identified in the last point is less clear from this plot.

#### Model 3

Let's build a third model in which we are filtering out the observations where people are not interested in joining a civic crowdfunding platform, and where we split the observations into the two following groups, related to the "interest" variable:

* Class 0: "Could_be_interested_Vol" and "Is_ready_Vol";
* Class 1: "Could_be_interested_Fund" and "Is_ready_Fund".

In other words, we are now interested to know what factors are associated with the difference between those willing to volunteer and those willing to fund.

The rest of the model is similar to models 1 and 2.

```{r message = FALSE, warning = FALSE}
survey_df_c_mat <- survey_df_c %>% 
  filter(gender %in% c("Female", "Male")) %>% 
  filter(interest != "Not_interested") %>% 
  mutate(interest_binary = ifelse(interest %in% c("Is_ready_Vol",
                                                  "Could_be_interested_Vol"),
                                  0,
                                  1)) %>% 
  select(interest_binary, language, p1:edu, -invest) %>% 
  data.matrix() %>% 
  as_data_frame()

glm3 <- glm(interest_binary ~ .,  family = "binomial", 
                  data = survey_df_c_mat)

summary(glm3)
```

We have two variables for which the p-value of the coefficient is less than 0.05. Let's extract them into the following table, which is ordered by "estimate" in descending order:

```{r}
options(scipen = 999, digits = 3)

glm3 %>% 
  tidy() %>%
  filter(p.value < 0.05) %>%
  arrange(desc(estimate)) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

We can interpret this table as follows:

1. Since the effect size associated with the variable p4 is positive, then people agreeing with the statement "I would be more inclined to contribute financially to a project on a civic crowdfunding platform if I had the possibility to express my disagreement about some aspects of the project." are more likely to be willing to fund rather than to volunteer, after controlling for the other variables in the model.

Let's have a look at a plot similar to what we did in the Exploratory Data Analysis, but without the category "Not interested" and with the class labels for the dependent variable re-ordered:

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p4 <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$p4[survey_df_c$interest != "Not_interested"]), 1)
p4_title <- "\nI would be more inclined to contribute financially to\na project on a civic crowdfunding platform if I had the possibility\nto express my disagreement about some aspects of the project.\n"

factor_levels_m3 <- c("Could_be_interested_Vol", "Is_ready_Vol", "Could_be_interested_Fund", "Is_ready_Fund")
lik_plot(t_p4, my_df_names, mylevels, factor_levels_m3, p4_title)
```

This confirms visually the positive relationship identified in point 1, and it seems to make more sense than for point 5 from the interpretation of the model 2.

2. Similarly, since the effect size associated with the variable p1 is positive, then people agreeing with the statement "Personally funding a citizen’s initiative is enough to satisfy my desire to engage in this project." are more likely to be willing to fund rather than to volunteer, after controlling for the other variables in the model.

Let's have a look at a plot similar to what we did in the Exploratory Data Analysis, but without the category "Not interested" and with the class labels for the dependent variable re-ordered:

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p1 <- prop.table(table(survey_df_c$interest[survey_df_c$interest != "Not_interested"], survey_df_c$p1[survey_df_c$interest != "Not_interested"]), 1)
p1_title <- "\n\nPersonally funding a citizen's initiative is enough to\nsatisfy my desire to engage in this project.\n"

factor_levels_m3 <- c("Could_be_interested_Vol", "Is_ready_Vol", "Could_be_interested_Fund", "Is_ready_Fund")
lik_plot(t_p1, my_df_names, mylevels, factor_levels_m3, p1_title)
```

This confirms visually the positive relationship identified in point 2.

### Logistic regression with past investment as the target variable

#### Model 4

In our last model, we are going to change our target variable. Instead of modeling the interest in citizens initiatives explained by all of the other variables, we will be modeling the respondants past investment in citizens initiatives.

In order for this response to be binary, we will split the observations into the two following groups, related to the `invest` variable:

* Class 0: "0", that is, the respondant did not report already investing in citizens initiatives;
* Class 1: All of the other choices ("1_99", "100_199", "200_499", "500_plus").

All of the other settings are the same as for the model 1.

```{r}
survey_df_c_mat <- survey_df_c %>% 
  filter(gender %in% c("Female", "Male")) %>% 
  filter(invest != "") %>%
  mutate(invest_binary = ifelse(invest == "0", 0, 1)) %>% 
  select(invest_binary, language, p1:edu, -invest) %>% 
  data.matrix() %>% 
  as_data_frame()

glm4 <- glm(invest_binary ~ .,  family = "binomial", 
            data = survey_df_c_mat)

summary(glm4)
```

We have a single variable for which the p-value of the coefficient is less than 0.05. Let’s extract it into the following table:

```{r}
options(scipen = 999, digits = 3)

glm4 %>% 
  tidy() %>%
  filter(p.value < 0.05) %>%
  arrange(desc(estimate)) %>% 
  kable() %>% 
  kable_styling(bootstrap_options = c("striped","hover"),
                full_width = F, position = "left", font_size = 14)
```

We can interpret this result as follows:

1. Since the effect size associated with the variable p2 is positive, then people agreeing with the statement "I would like to participate in debates on local public issues." are more likely to be already investing in citizens initiatives than not investing, after controlling for the other variables in the model.

Let's re-examine a plot that we already showed in the Exploratory Data Analysis:

```{r fig.height = 4, fig.width = 10, fig.align = "center"}
t_p2 <- prop.table(table(survey_df_c_inv$invest, survey_df_c_inv$p2), 1)
p2_title <- "\n\nI would like to participate in debates on local public issues.\n"

lik_plot(t_p2, my_df_names_c_inv, mylevels_c_inv,
         factor_levels_c_inv, p2_title)
```

As mentionned in the Exploratory Data Analysis, observations where the investment is "0" represent about 57% of the sample. Therefore, from this plot we can visually confirm the result from the model 4.
